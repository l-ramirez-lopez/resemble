% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/funlib.R
\name{final_fits}
\alias{final_fits}
\title{Internal: Compute weighted final PLS model outputs}
\usage{
final_fits(
  ilocalsubset,
  min_component,
  max_component,
  scale,
  maxiter,
  tol,
  ...
)
}
\arguments{
\item{ilocalsubset}{A list with local subset data:
\itemize{
\item \code{x}: matrix of predictors from the local neighborhood.
\item \code{y}: response vector or 1-col matrix for local samples.
}}

\item{min_component}{Integer; minimum number of components used for output.}

\item{max_component}{Integer; maximum number of components to fit in PLS.}

\item{scale}{Logical; whether to scale predictors before PLS fitting.}

\item{maxiter}{Integer; maximum number of iterations for the PLS algorithm.}

\item{tol}{Numeric; convergence tolerance for the PLS algorithm.}

\item{...}{Additional arguments (currently unused).}
}
\value{
A numeric vector containing the following, in order:
\itemize{
\item Intercept term (weighted average of component intercepts)
\item Weighted regression coefficients
\item Weighted VIP scores (normalized by column SDs)
\item Weighted selectivity ratios (normalized by column SDs)
\item Predictor scaling values (from training transformation)
}
}
\description{
Fits a PLS model on a local neighborhood and computes a weighted combination
of regression coefficients, intercept, VIP scores, selectivity ratios, and
predictor scales based on component-specific weights.
}
\details{
This function fits a PLS model on the local neighborhood using
\code{opls_get_all()}, computes local weights with
\code{get_local_pls_weights()}, and combines all component-wise metrics
into a final weighted output.

Component indices are selected using the range
\code{min_component:max_component}. Weighting is applied to each component
across coefficients, VIPs, and selectivity ratios. All component-wise scores
are normalized before aggregation. The result can be used as a compressed
representation of the final prediction model.

Note: the prediction target is assumed to be \code{x[1, ]} of the subset.
}
\author{
Leonardo Ramirez-Lopez
}
\keyword{internal}
